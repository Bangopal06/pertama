<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Test Supabase Fresh</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #result { margin-top: 20px; padding: 20px; background: #f0f0f0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Test Supabase Connection</h1>
    <button id="testBtn">Klik untuk Test</button>
    <div id="result">Klik tombol untuk mulai test...</div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Inisialisasi Supabase
        const supabaseUrl = 'https://dyawxkqcrzawgfglzbcm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5YXd4a3Fjcnphd2dmZ2x6YmNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NjM2MjgsImV4cCI6MjA4NjMzOTYyOH0.agf23zlfti9UUsTNiK_aQmjnGUiiFOh_3CrUOIbFMaM';
        const sb = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        document.getElementById('testBtn').addEventListener('click', async function() {
            const result = document.getElementById('result');
            result.innerHTML = 'Testing...\n\n';
            
            try {
                // Test 1: Check if Supabase is initialized
                result.innerHTML += '1. Checking Supabase initialization...\n';
                result.innerHTML += '   URL: ' + supabaseUrl + '\n';
                result.innerHTML += '   Client created: ' + (sb ? 'YES' : 'NO') + '\n\n';
                
                // Test 2: Try to connect
                result.innerHTML += '2. Testing connection to berita table...\n';
                const { data: countData, error: countError } = await sb
                    .from('berita')
                    .select('*', { count: 'exact', head: true });
                
                if (countError) {
                    result.innerHTML += '   ERROR: ' + JSON.stringify(countError, null, 2) + '\n\n';
                    result.innerHTML += '   Kemungkinan masalah:\n';
                    result.innerHTML += '   - Tabel "berita" belum dibuat\n';
                    result.innerHTML += '   - RLS (Row Level Security) memblokir akses\n';
                    result.innerHTML += '   - URL atau API Key salah\n';
                    return;
                }
                result.innerHTML += '   Connection SUCCESS!\n\n';
                
                // Test 3: Try to insert
                result.innerHTML += '3. Testing INSERT...\n';
                const testBerita = {
                    judul: 'Test Berita ' + new Date().toLocaleTimeString(),
                    konten: 'Ini adalah test konten berita dari test page',
                    kategori: 'Pengumuman',
                    tanggal: new Date().toISOString()
                };
                
                result.innerHTML += '   Data to insert: ' + JSON.stringify(testBerita, null, 2) + '\n';
                
                const { data: insertData, error: insertError } = await sb
                    .from('berita')
                    .insert([testBerita])
                    .select();
                
                if (insertError) {
                    result.innerHTML += '   INSERT ERROR: ' + JSON.stringify(insertError, null, 2) + '\n\n';
                    result.innerHTML += '   Kemungkinan masalah:\n';
                    result.innerHTML += '   - RLS policy memblokir INSERT\n';
                    result.innerHTML += '   - Kolom yang required tidak diisi\n';
                    result.innerHTML += '   - Tipe data tidak sesuai\n\n';
                    result.innerHTML += '   SOLUSI: Jalankan SQL berikut di Supabase SQL Editor:\n';
                    result.innerHTML += '   ALTER TABLE berita DISABLE ROW LEVEL SECURITY;\n';
                    return;
                }
                
                result.innerHTML += '   INSERT SUCCESS!\n';
                result.innerHTML += '   Inserted data: ' + JSON.stringify(insertData, null, 2) + '\n\n';
                
                // Test 4: Try to select
                result.innerHTML += '4. Testing SELECT...\n';
                const { data: selectData, error: selectError } = await sb
                    .from('berita')
                    .select('*')
                    .order('id', { ascending: false })
                    .limit(5);
                
                if (selectError) {
                    result.innerHTML += '   SELECT ERROR: ' + JSON.stringify(selectError, null, 2) + '\n';
                    return;
                }
                
                result.innerHTML += '   SELECT SUCCESS!\n';
                result.innerHTML += '   Found ' + selectData.length + ' records\n';
                result.innerHTML += '   Latest data: ' + JSON.stringify(selectData, null, 2) + '\n\n';
                
                result.innerHTML += '=== ALL TESTS PASSED! ===\n';
                result.innerHTML += 'Supabase connection is working properly!\n';
                
            } catch (err) {
                result.innerHTML += '\nEXCEPTION: ' + err.message + '\n';
                result.innerHTML += 'Stack: ' + err.stack;
                console.error(err);
            }
        });
    </script>
</body>
</html>
